(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9bef0022"],{"26b2":function(e,t,n){},"318e":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-account"},[n("div",{staticClass:"container"},[n("div",{staticClass:"page-account-top "},[n("img",{attrs:{src:e.login_logo,alt:"logo"}})])]),n("div",{staticClass:"index_from page-account-container"},[n("div",{staticClass:"title"},[e._v("门店管理")]),n("Form",{ref:"formInline",attrs:{model:e.formInline,rules:e.ruleInline},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubmit("formInline")}}},[n("FormItem",{attrs:{prop:"username"}},[n("Input",{attrs:{type:"text",prefix:"ios-contact-outline",placeholder:"请输入用户名",size:"default"},model:{value:e.formInline.username,callback:function(t){e.$set(e.formInline,"username",t)},expression:"formInline.username"}})],1),n("FormItem",{attrs:{prop:"password"}},[n("Input",{attrs:{type:"password",prefix:"ios-lock-outline",placeholder:"请输入密码",size:"default"},model:{value:e.formInline.password,callback:function(t){e.$set(e.formInline,"password",t)},expression:"formInline.password"}})],1),n("FormItem",{attrs:{prop:"code"}},[n("div",{staticClass:"code"},[n("Input",{attrs:{type:"text",prefix:"ios-keypad-outline",placeholder:"请输入验证码",size:"default"},model:{value:e.formInline.code,callback:function(t){e.$set(e.formInline,"code",t)},expression:"formInline.code"}}),n("img",{staticClass:"pictrue",attrs:{src:e.imgcode},on:{click:e.captchas}})],1)]),n("FormItem",[n("Button",{staticClass:"btn",attrs:{type:"primary",long:"",size:"default"},on:{click:function(t){return e.handleSubmit("formInline")}}},[e._v(e._s(e.$t("page.login.submit"))+"\n                ")])],1)],1),n("div",{staticClass:"info"},[e._v(e._s(e.site_url)+" "+e._s(e.site_name))])],1),n("Modal",{attrs:{scrollable:"","footer-hide":"",closable:"",title:"请完成安全校验","mask-closable":!1,"z-index":2,width:"342"},model:{value:e.modals,callback:function(t){e.modals=t},expression:"modals"}},[n("div",{staticClass:"captchaBox"},[n("div",{ref:"captcha",staticStyle:{position:"relative"},attrs:{id:"captcha"}}),n("div",{attrs:{id:"msg"}})])])],1)},a=[],s=n("a34a"),o=n.n(s),r=n("5723"),c=n("3dda"),l=n.n(c),u=n("d708"),d=n("c276");n("9973");function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}var m=310,v=155,g=42,w=9,b=Math.PI,k=g+2*w+3;function x(e,t){return Math.round(Math.random()*(t-e)+e)}function y(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}function _(e){var t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=function(){t.setSrc(S())},t.setSrc=function(e){var n=window.navigator.userAgent.indexOf("Trident")>-1;if(n){var i=new XMLHttpRequest;i.onloadend=function(e){var n=new FileReader;n.readAsDataURL(e.target.response),n.onloadend=function(e){t.src=e.target.result}},i.open("GET",e),i.responseType="blob",i.send()}else t.src=e},t.setSrc(S()),t}function C(e,t){var n=document.createElement(e);return n.className=t,n}function I(e,t){e.classList.add(t)}function M(e,t){e.classList.remove(t)}function S(){return"https://picsum.photos/".concat(m,"/").concat(v,"/?image=").concat(x(0,1084))}function $(e,t,n,i){e.beginPath(),e.moveTo(t,n),e.arc(t+g/2,n-w+2,w,.72*b,2.26*b),e.lineTo(t+g,n),e.arc(t+g+w-2,n+g/2,w,1.21*b,2.78*b),e.lineTo(t+g,n+g),e.lineTo(t,n+g),e.arc(t+w-2,n+g/2,w+.4,2.76*b,1.24*b,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e[i](),e.globalCompositeOperation="destination-over"}function L(e,t){return e+t}function E(e){return e*e}var T=function(){function e(t){var n=t.el,i=t.width,a=void 0===i?310:i,s=t.height,o=void 0===s?155:s,r=t.onSuccess,c=t.onFail,l=t.onRefresh;f(this,e),m=a,v=o,n.style.position="relative",n.style.width=m+"px",Object.assign(n.style,{position:"relative",width:m+"px",margin:"0 auto"}),this.el=n,this.onSuccess=r,this.onFail=c,this.onRefresh=l}return p(e,[{key:"init",value:function(){this.initDOM(),this.initImg(),this.bindEvents()}},{key:"initDOM",value:function(){var e=y(m,v),t=e.cloneNode(!0),n=C("div","sliderContainer");n.style.width=m+"px";var i=C("div","refreshIcon"),a=C("div","sliderMask"),s=C("div","slider"),o=C("span","sliderIcon"),r=C("span","sliderText");t.className="block",r.innerHTML="向右滑动填充拼图";var c=this.el;c.appendChild(e),c.appendChild(i),c.appendChild(t),s.appendChild(o),a.appendChild(s),n.appendChild(a),n.appendChild(r),c.appendChild(n),Object.assign(this,{canvas:e,block:t,sliderContainer:n,refreshIcon:i,slider:s,sliderMask:a,sliderIcon:o,text:r,canvasCtx:e.getContext("2d"),blockCtx:t.getContext("2d")})}},{key:"initImg",value:function(){var e=this,t=_((function(){e.draw(),e.canvasCtx.drawImage(t,0,0,m,v),e.blockCtx.drawImage(t,0,0,m,v);var n=e.y-2*w-1,i=e.blockCtx.getImageData(e.x-3,n,k,k);e.block.width=k,e.blockCtx.putImageData(i,0,n)}));this.img=t}},{key:"draw",value:function(){this.x=x(k+10,m-(k+10)),this.y=x(10+2*w,v-(k+10)),$(this.canvasCtx,this.x,this.y,"fill"),$(this.blockCtx,this.x,this.y,"clip")}},{key:"clean",value:function(){this.canvasCtx.clearRect(0,0,m,v),this.blockCtx.clearRect(0,0,m,v),this.block.width=m}},{key:"bindEvents",value:function(){var e=this;this.el.onselectstart=function(){return!1},this.refreshIcon.onclick=function(){e.reset(),"function"===typeof e.onRefresh&&e.onRefresh()};var t,n,i=[],a=!1,s=function(e){t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,a=!0},o=function(s){if(!a)return!1;var o=s.clientX||s.touches[0].clientX,r=s.clientY||s.touches[0].clientY,c=o-t,l=r-n;if(c<0||c+38>=m)return!1;e.slider.style.left=c+"px";var u=(m-40-20)/(m-40)*c;e.block.style.left=u+"px",I(e.sliderContainer,"sliderContainer_active"),e.sliderMask.style.width=c+"px",i.push(l)},r=function(n){if(!a)return!1;a=!1;var s=n.clientX||n.changedTouches[0].clientX;if(s===t)return!1;M(e.sliderContainer,"sliderContainer_active"),e.trail=i;var o=e.verify(),r=o.spliced,c=o.verified;r?c?(I(e.sliderContainer,"sliderContainer_success"),"function"===typeof e.onSuccess&&e.onSuccess()):(I(e.sliderContainer,"sliderContainer_fail"),e.text.innerHTML="请再试一次",e.reset()):(I(e.sliderContainer,"sliderContainer_fail"),"function"===typeof e.onFail&&e.onFail(),setTimeout((function(){e.reset()}),1e3))};this.slider.addEventListener("mousedown",s),this.slider.addEventListener("touchstart",s),this.block.addEventListener("mousedown",s),this.block.addEventListener("touchstart",s),document.addEventListener("mousemove",o),document.addEventListener("touchmove",o),document.addEventListener("mouseup",r),document.addEventListener("touchend",r)}},{key:"verify",value:function(){var e=this.trail,t=e.reduce(L)/e.length,n=e.map((function(e){return e-t})),i=Math.sqrt(n.map(E).reduce(L)/e.length),a=parseInt(this.block.style.left);return{spliced:Math.abs(a-this.x)<10,verified:0!==i}}},{key:"reset",value:function(){this.sliderContainer.className="sliderContainer",this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.img.setSrc(S())}}]),e}();function j(e,t,n,i,a,s,o){try{var r=e[s](o),c=r.value}catch(l){return void n(l)}r.done?t(c):Promise.resolve(c).then(i,a)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var s=e.apply(t,n);function o(e){j(s,i,a,o,r,"next",e)}function r(e){j(s,i,a,o,r,"throw",e)}o(void 0)}))}}window.jigsaw={init:function(e){var t=new T(e);return t.init(),t}};var F={mixins:[l.a],data:function(){return{modals:!1,autoLogin:!0,imgcode:"",formInline:{username:"",password:"",code:""},ruleInline:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},errorNum:0,jigsaw:null,login_logo:"",site_name:"",site_url:""}},created:function(){var e=this;top!=window&&(top.location.href=location.href),document.onkeydown=function(t){if("login"===e.$route.name){var n=window.event.keyCode;13===n&&e.handleSubmit("formInline")}}},watch:{$route:function(e){this.captchas()}},mounted:function(){var e=this;this.$nextTick((function(){var t=e;e.jigsaw=jigsaw.init({el:e.$refs.captcha,onSuccess:function(){t.modals=!1,t.closeModel()},onFail:e.closefail,onRefresh:function(){}}),e.swiperData()})),this.captchas()},methods:{swiperData:function(){var e=this;Object(r["e"])().then((function(t){var i=t.data||{};e.login_logo=i.login_logo?i.login_logo:n("9d64"),e.site_name=i.site_name,e.site_url=i.site_url,localStorage.setItem("file_size_max",i.upload_file_size_max)})).catch((function(t){e.$Message.error(t.msg)}))},closeModel:function(){var e=this,t=this.$Message.loading({content:"登录中...",duration:0});Object(r["a"])({account:this.formInline.username,pwd:this.formInline.password,imgcode:this.formInline.code}).then(function(){var n=O(o.a.mark((function n(i){var a,s,r,c;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.$store.dispatch("store/account/setPageTitle"),t(),a=i.data.expires_time,d["a"].cookies.set("uuid",i.data.user_info.id,{expires:a}),d["a"].cookies.set("token",i.data.token,{expires:a}),d["a"].cookies.set("expires_time",i.data.expires_time,{expires:a}),n.next=8,e.$store.dispatch("store/db/database",{user:!0});case 8:return s=n.sent,s.set("unique_auth",i.data.unique_auth).set("user_info",i.data.user_info).write(),e.$store.commit("store/menus/getmenusNav",i.data.menus),r={account:i.data.user_info.account,avatar:i.data.user_info.avatar,logo:i.data.logo,logoSmall:i.data.logo_square},c=window.localStorage,c.setItem("userInfoStore",JSON.stringify(r)),e.$store.dispatch("store/user/set",{name:i.data.user_info.account,avatar:i.data.user_info.avatar,access:i.data.unique_auth,logo:i.data.logo,logoSmall:i.data.logo_square,version:i.data.version,newOrderAudioLink:i.data.newOrderAudioLink}),e.jigsaw&&e.jigsaw.reset(),n.abrupt("return",e.$router.replace({path:e.$route.query.redirect||"/store/"}));case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(n){t();var i=void 0===n?{}:n;e.errorNum++,e.captchas(),e.$Message.error(i.msg||"登录失败"),e.jigsaw&&e.jigsaw.reset()}))},getExpiresTime:function(e){var t=Math.round(new Date/1e3),n=e-t;return parseFloat(parseFloat(parseFloat(n/60)/60)/24)},closefail:function(){this.jigsaw&&this.jigsaw.reset(),this.$Message.error("校验错误")},captchas:function(){this.imgcode=u["a"].apiBaseURL+"/captcha_store?"+Date.parse(new Date)},handleSubmit:function(e){var t=this;this.$refs[e].validate((function(e){e&&(t.errorNum>=2?t.modals=!0:t.closeModel())}))}}},q=F,R=(n("8947"),n("2877")),D=Object(R["a"])(q,i,a,!1,null,"4758f4bb",null);t["default"]=D.exports},"3dda":function(e,t){},8947:function(e,t,n){"use strict";var i=n("26b2"),a=n.n(i);a.a},9973:function(e,t,n){}}]);