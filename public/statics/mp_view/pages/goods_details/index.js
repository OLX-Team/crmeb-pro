(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods_details/index"],{"0afd":function(t,e,o){},"4ba4":function(t,e,o){"use strict";(function(t){o("22b3");i(o("66fd"));var e=i(o("4f45"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(e.default)}).call(this,o("543d")["createPage"])},"4f45":function(t,e,o){"use strict";o.r(e);var i=o("b268"),n=o("87b1");for(var s in n)"default"!==s&&function(t){o.d(e,t,(function(){return n[t]}))}(s);o("912f");var r,a=o("f0c5"),c=Object(a["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);e["default"]=c.exports},"87b1":function(t,e,o){"use strict";o.r(e);var i=o("a9bc"),n=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},"912f":function(t,e,o){"use strict";var i=o("0afd"),n=o.n(i);n.a},a9bc:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o("16a8"),n=o("d5e6"),s=o("4e1f"),r=o("21c4"),a=o("fa9e"),c=o("26cb"),u=o("8a96"),l=(o("29b6"),p(o("506a")),o("12b8")),h=o("6082"),d=p(o("d0ca"));function p(t){return t&&t.__esModule?t:{default:t}}function f(t){return $(t)||v(t)||g(t)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,e){if(t){if("string"===typeof t)return C(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?C(t,e):void 0}}function v(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function $(t){if(Array.isArray(t))return C(t)}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}var _=t.getSystemInfoSync().statusBarHeight+"px",S=function(){Promise.all([o.e("common/vendor"),o.e("components/zb-code/zb-code")]).then(function(){return resolve(o("7322"))}.bind(null,o)).catch(o.oe)},I=function(){o.e("components/countDown/index").then(function(){return resolve(o("6094"))}.bind(null,o)).catch(o.oe)},y=function(){Promise.all([o.e("common/vendor"),o.e("components/storeLis/index")]).then(function(){return resolve(o("3649"))}.bind(null,o)).catch(o.oe)},b=function(){o.e("components/productConSwiper/index").then(function(){return resolve(o("d373"))}.bind(null,o)).catch(o.oe)},w=function(){Promise.all([o.e("common/vendor"),o.e("components/couponListWindow/index")]).then(function(){return resolve(o("0a50"))}.bind(null,o)).catch(o.oe)},k=function(){o.e("components/productWindow/index").then(function(){return resolve(o("6ab7"))}.bind(null,o)).catch(o.oe)},x=function(){o.e("components/ensure/index").then(function(){return resolve(o("3c6d"))}.bind(null,o)).catch(o.oe)},A=function(){o.e("components/specs/index").then(function(){return resolve(o("ff8f"))}.bind(null,o)).catch(o.oe)},P=function(){o.e("components/discount/index").then(function(){return resolve(o("d72f"))}.bind(null,o)).catch(o.oe)},T=function(){Promise.all([o.e("common/vendor"),o.e("components/userEvaluation/index")]).then(function(){return resolve(o("ea61"))}.bind(null,o)).catch(o.oe)},L=function(){o.e("components/shareRedPackets/index").then(function(){return resolve(o("04d6"))}.bind(null,o)).catch(o.oe)},D=function(){Promise.all([o.e("common/vendor"),o.e("components/kefuIcon/index")]).then(function(){return resolve(o("4f2e"))}.bind(null,o)).catch(o.oe)},F=function(){o.e("components/discountsList/index").then(function(){return resolve(o("0cd0"))}.bind(null,o)).catch(o.oe)},V=function(){o.e("components/cusPreviewImg/index").then(function(){return resolve(o("24e9"))}.bind(null,o)).catch(o.oe)},H=function(){o.e("components/homeList/index").then(function(){return resolve(o("67fc"))}.bind(null,o)).catch(o.oe)},M=function(){Promise.all([o.e("common/vendor"),o.e("components/mp-html/mp-html")]).then(function(){return resolve(o("f364"))}.bind(null,o)).catch(o.oe)},N=function(){o.e("components/Authorize").then(function(){return resolve(o("1702"))}.bind(null,o)).catch(o.oe)},O=getApp(),j={components:{zbCode:S,productConSwiper:b,couponListWindow:w,productWindow:k,userEvaluation:T,shareRedPackets:L,kefuIcon:D,mpHtml:M,storeLis:y,discountsList:F,cusPreviewImg:V,ensure:x,specs:A,discount:P,countDown:I,homeList:H,authorize:N},directives:{trigger:{inserted:function(t,e){t.click()}}},mixins:[d.default],data:function(){return{showSkeleton:!0,isNodes:0,coupon:{coupon:!1,type:-1,list:[],count:[]},attrTxt:"请选择",attrValue:"",animated:!1,id:0,replyCount:0,reply:[],storeInfo:{brand_name:""},productValue:[],couponList:[],cart_num:1,isAuto:!1,isShowAuth:!1,isOpen:!1,actionSheetHidden:!0,posterImageStatus:!1,storeImage:"",PromotionCode:"",canvasStatus:!1,posterImage:"",posterbackgd:"/static/images/posterbackgd.png",sharePacket:{isState:!0},uid:0,circular:!1,autoplay:!1,interval:3e3,duration:500,clientHeight:"",systemStore:{},good_list:[],replyChance:0,CartCount:0,isDown:!0,storeSelfMention:!0,posters:!1,weixinStatus:!1,ensureInfo:{show:!1,ensure:[],ensureTitle:""},specsInfo:{show:!1,specs:[]},discountInfo:{show:!1,discount:[]},attr:{cartAttr:!1,productAttr:[],productSelect:{}},limitInfo:{discount_price:0,price:0,discount:1,datatime:0},promotions_type:0,description:"",navActive:0,H5ShareBox:!1,activity:[],navH:"",navList:[],opacity:0,scrollY:0,topArr:[],toView:"",height:0,heightArr:[],lock:!1,scrollTop:0,tagStyle:{img:"width:100%;display:block;",table:"width:100%",video:"width:100%"},returnShow:!0,diff:"",is_money_level:1,is_vip:0,navbarRight:0,homeTop:20,routineContact:0,discountsData:[],siteName:"",themeColor:"",fontColor:"",isMention:!1,showAnimate:!0,skuArr:[],codeShow:!1,cid:"1",codeVal:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",codeIcon:"",iconsize:40,lv:3,onval:!0,loadMake:!0,base64Show:0,shareQrcode:0,followCode:"",selectSku:{},currentPage:!1,sysHeight:_,isShow:0,storeLen:1,imgHost:l.HTTP_REQUEST_URL}},computed:(0,c.mapGetters)(["isLogin"]),watch:{isLogin:{handler:function(t,e){1==t&&(this.getCouponList(),this.getCartCount())},deep:!0},storeInfo:{handler:function(){this.$nextTick((function(){}))},immediate:!0}},onLoad:function(e){var o=this,i=this,n=getCurrentPages();if(i.returnShow=1!==n.length,i.navH=O.globalData.navHeight,i.id=e.id,i.isShow=e.isShow,i.promotions_type=e.promotions_type||0,i.isLogin&&e.id&&i.downloadFilePromotionCode(),t.getSystemInfo({success:function(e){i.height=e.windowHeight,i.navbarRight=e.windowWidth-t.getMenuButtonBoundingClientRect().left}}),e.scene){var s=i.$util.getUrlParams(decodeURIComponent(e.scene));s.id&&(e.id=s.id),s.pid&&(O.globalData.spid=s.pid)}if(!e.id)return this.showSkeleton=!1,i.$util.Tips({title:"缺少参数无法查看商品"},{tab:3,url:1});i.id=e.id,e.pid&&(O.globalData.spid=e.pid),i.getGoodsDetails(),this.colorData();var r=[{themeColor:"#1DB0FC",fontColor:"#FD502F"},{themeColor:"#42CA4D",fontColor:"#FF7600"},{themeColor:"#e93323",fontColor:"#e93323"},{themeColor:"#FF448F",fontColor:"#FF448F"},{themeColor:"#FE5C2D",fontColor:"#FE5C2D"}];setTimeout((function(){switch(o.colorNum){case 1:o.themeColor=r[0].themeColor,o.fontColor=r[0].fontColor;break;case 2:o.themeColor=r[1].themeColor,o.fontColor=r[1].fontColor;break;case 3:o.themeColor=r[2].themeColor,o.fontColor=r[2].fontColor;break;case 4:o.themeColor=r[3].themeColor,o.fontColor=r[3].fontColor;break;case 5:o.themeColor=r[4].themeColor,o.fontColor=r[4].fontColor;break;default:o.themeColor=r[2].themeColor,o.fontColor=r[2].fontColor;break}}),1)},onReady:function(){this.isNodes++,this.$nextTick((function(){var e=this,o=t.getMenuButtonBoundingClientRect(),i=t.createSelectorQuery().in(this);i.select("#home").boundingClientRect((function(t){e.homeTop=2*o.top+o.height-t.height})).exec()}))},onShareAppMessage:function(){var t=this;return t.$set(t,"actionSheetHidden",!t.actionSheetHidden),(0,n.userShare)(),{title:t.storeInfo.store_name||"",imageUrl:t.storeInfo.image||"",path:"/pages/goods_details/index?id="+t.id+"&pid="+t.uid}},onShareTimeline:function(){var t=this;return{title:t.storeInfo.store_name||"",imageUrl:t.storeInfo.image||"",path:"/pages/goods_details/index?id="+t.id+"&pid="+t.uid}},methods:{getStoreList:function(t){this.storeLen=t},seeEnsure:function(){this.ensureInfo.show=!0},seeSpecs:function(){this.specsInfo.show=!0},seeDiscount:function(){this.discountInfo.show=!0},moreNav:function(){this.currentPage=!this.currentPage},showImg:function(t){this.$refs.cusPreviewImg.open(this.selectSku.suk)},changeSwitch:function(t){var e=this,o=this.skuArr[t];this.$set(this,"selectSku",o);var i=o.suk.split(",");i.forEach((function(t,o){e.$set(e.attr.productAttr[o],"index",i[o])})),o&&(this.$set(this.attr.productSelect,"image",o.image),this.$set(this.attr.productSelect,"price",o.price),this.$set(this.attr.productSelect,"stock",o.stock),this.$set(this.attr.productSelect,"unique",o.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",o.vip_price),this.$set(this,"attrValue",o.suk),this.$set(this,"attrTxt","已选择"))},qrR:function(t){},boxStatus:function(t){this.showAnimate=t},followWX:function(){var t=this;(0,i.getProductCode)(this.id).then((function(e){t.followCode=e.data.code,t.getImageBase64(1)})).catch((function(e){t.$util.Tips({title:e})}))},getpreviewImage:function(){if(this.posterImage){var e=[];e.push(this.posterImage),t.previewImage({urls:e,current:this.posterImage})}else this.$util.Tips({title:"您的海报尚未生成"})},showStoreList:function(){t.navigateTo({url:"/pages/users/goods_details_store/index"})},videoPause:function(){this.$nextTick((function(){that.infoScroll()}))},closeChange:function(){this.$set(this.sharePacket,"isState",!0)},goActivity:function(e){var o=e;"1"===o.type?t.navigateTo({url:"/pages/activity/goods_seckill_details/index?id=".concat(o.id,"&time=").concat(o.time,"&status=1")}):"2"===o.type?t.navigateTo({url:"/pages/activity/goods_bargain_details/index?id=".concat(o.id,"&bargain=").concat(this.uid)}):t.navigateTo({url:"/pages/activity/goods_combination_details/index?id=".concat(o.id)})},iptCartNum:function(t){this.$set(this.attr.productSelect,"cart_num",t)},returns:function(){if(!this.isShow)return t.navigateBack({delta:1});t.reLaunch({url:"/pages/index/index"})},tap:function(t){var e="past"+t,o=(t=t,this);this.$set(this,"toView",e),this.$set(this,"navActive",t),this.$set(this,"lock",!0),this.$set(this,"scrollTop",t>0?o.topArr[t]-O.globalData.navHeight/2:o.topArr[t])},scroll:function(t){var e=this,o=t.detail.scrollTop,i=o/200;i=i>1?1:i;var n=!(o>0);if(e.$set(e,"opacity",i),e.$set(e,"scrollY",o),e.$set(e,"showAnimate",n),e.$set(e,"currentPage",!1),e.lock)e.$set(e,"lock",!1);else for(var s=0;s<e.topArr.length;s++)if(o<e.topArr[s]-O.globalData.navHeight/2+e.heightArr[s]){e.$set(e,"navActive",s);break}},goDetail:function(e){0!=e.activity.length?e.activity&&2==e.activity.type?t.redirectTo({url:"/pages/activity/goods_bargain_details/index?id=".concat(e.activity.id,"&bargain=").concat(this.uid)}):e.activity&&3==e.activity.type?t.redirectTo({url:"/pages/activity/goods_combination_details/index?id=".concat(e.activity.id)}):e.activity&&1==e.activity.type&&t.redirectTo({url:"/pages/activity/goods_seckill_details/index?id=".concat(e.activity.id,"&time=").concat(e.activity.time,"&status=1")}):t.redirectTo({url:"/pages/goods_details/index?id="+e.id})},onLoadFun:function(t){},ChangCouponsClone:function(){this.$set(this.coupon,"coupon",!1)},getUserInfo:function(){var t=this;(0,n.getUserInfo)().then((function(e){t.$set(t.sharePacket,"isState",0==t.sharePacket.priceName),t.$set(t,"uid",e.data.uid),t.$set(t,"is_money_level",e.data.is_money_level)}))},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(void 0!==e||this.attr.productAttr.length||(e=this.attr.productSelect),void 0!==e){var o=e.stock||0,i=this.attr.productSelect;t?(i.cart_num++,i.cart_num>o&&(this.$set(this.attr.productSelect,"cart_num",o||1),this.$set(this,"cart_num",o||1))):(i.cart_num--,i.cart_num<1&&(this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"cart_num",1)))}},attrVal:function(t){this.$set(this.attr.productAttr[t.indexw],"index",this.attr.productAttr[t.indexw].attr_values[t.indexn])},ChangeAttr:function(t){var e=this.productValue[t];this.$set(this,"selectSku",e),e&&e.stock>=0?(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"stock",e.stock),this.$set(this.attr.productSelect,"unique",e.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",e.vip_price),this.$set(this,"attrValue",t),this.$set(this,"attrTxt","已选择")):(this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"vip_price",this.storeInfo.vip_price),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},ChangCoupons:function(t){var e=t,o=this.$util.ArrayRemove(this.couponList,"id",e.id);this.$set(this,"couponList",o),this.getCouponList()},setClientHeight:function(){var e=this;if(e.good_list.length){var o=t.createSelectorQuery().in(this).select("#list0");o.fields({size:!0},(function(t){e.$set(e,"clientHeight",t.height+20)})).exec()}},getGoodsDetails:function(){var e=this,o=this;(0,i.getProductDetail)(o.id,{promotions_type:this.promotions_type}).then((function(i){for(var n=i.data.storeInfo,s=i.data.good_list||[],r=Math.ceil(s.length/6),a=new Array,c=0;c<r;c++){var u=s.slice(6*c,6*c+6);u.length&&a.push({list:u})}-1!=i.data.storeInfo.delivery_type.indexOf("2")&&o.$set(o,"isMention",!0);var l=n.promotions[0];if(o.$set(o,"promotions_type",n.promotions.length?l.promotions_type:0),n.promotions.length&&1==l.promotions_type){var h=o.$util.$h.Div(l.discount,100),d=o.$util.$h.Mul(h,n.price);o.$set(o.limitInfo,"price",n.price||0),o.$set(o.limitInfo,"datatime",l.stop_time||0),o.$set(o.limitInfo,"discount",h),o.$set(o.limitInfo,"discount_price",d)}o.$set(o,"storeInfo",n),o.$set(o.ensureInfo,"ensure",n.ensure);var p=[];for(var f in n.ensure.forEach((function(t){p.push(t.name)})),o.$set(o.ensureInfo,"ensureTitle",p.join(" · ")),o.$set(o.specsInfo,"specs",n.specs),o.$set(o.discountInfo,"discount",n.promotions),o.$set(o,"description",n.description),e.description=e.description.replace(/<img/gi,'<img style="max-width:100%;height:auto;float:left;display:block" '),o.$set(o,"reply",i.data.reply?[i.data.reply]:[]),o.$set(o,"replyCount",i.data.replyCount),o.$set(o,"replyChance",i.data.replyChance),o.$set(o.attr,"productAttr",i.data.productAttr),o.$set(o,"productValue",i.data.productValue),i.data.productValue){var m=i.data.productValue[f];o.skuArr.push(m)}e.$set(e,"selectSku",o.skuArr[0]),o.$set(o,"is_vip",i.data.storeInfo.is_vip),o.$set(o.sharePacket,"priceName",i.data.priceName),o.$set(o,"systemStore",i.data.system_store),o.$set(o,"storeSelfMention",i.data.store_self_mention),o.$set(o,"good_list",a),o.$set(o,"activity",i.data.activity?i.data.activity:[]),o.$set(o,"couponList",i.data.coupons),o.$set(o,"shareQrcode",i.data.share_qrcode),o.$set(o,"routineContact",Number(i.data.routine_contact_type)),o.$set(o,"discountsData",i.data.discounts_products?i.data.discounts_products:[]),t.setNavigationBarTitle({title:n.store_name.substring(0,13)+"..."}),o.$set(o,"diff",o.$util.$h.Sub(n.price,n.vip_price)),o.siteName=i.data.site_name;var g=["商品","详情"];i.data.replyCount&&g.splice(1,0,"评价"),a.length&&g.splice(-1,0,"推荐"),o.$set(o,"navList",g),o.isLogin&&o.getUserInfo(),e.$nextTick((function(){s.length&&o.setClientHeight()})),setTimeout((function(){o.infoScroll()}),500),o.downloadFilestoreImage(),o.DefaultSelect(),o.getCartCount(),setTimeout((function(){e.showSkeleton=!1}),300)})).catch((function(t){return o.$util.Tips({title:t.toString()},{tab:3,url:1})}))},infoScroll:function(){for(var e=this,o=[],i=[],n=0;n<e.navList.length;n++){var s=t.createSelectorQuery().in(this),r="#past"+n;(!this.replyCount&&!e.good_list.length&&1==n||this.replyCount&&!e.good_list.length&&2==n||!this.replyCount&&e.good_list.length&&2==n)&&(r="#past3"),!this.replyCount&&e.good_list.length&&1==n&&(r="#past2"),s.select(r).boundingClientRect(),s.exec((function(t){var n=t[0].top,s=t[0].height;o.push(n),i.push(s),e.$set(e,"topArr",o),e.$set(e,"heightArr",i)}))}},makePhone:function(){t.makePhoneCall({phoneNumber:this.systemStore.phone})},showMaoLocation:function(){if(!this.systemStore.latitude||!this.systemStore.longitude)return this.$util.Tips({title:"缺少经纬度信息无法查看地图！"});t.openLocation({latitude:parseFloat(this.systemStore.latitude),longitude:parseFloat(this.systemStore.longitude),scale:8,name:this.systemStore.name,address:this.systemStore.address+this.systemStore.detailed_address,success:function(){}})},DefaultSelect:function(){var t=this.attr.productAttr,e=[],o=[];for(var i in this.productValue)if(this.productValue[i].stock>0){e=this.attr.productAttr.length?i.split(","):[];break}o=!e.length&&this.attr.productAttr.length?Object.keys(this.productValue)[0].split(","):e;for(var n=0;n<t.length;n++)this.$set(t[n],"index",o[n]);var s=this.productValue[o.join(",")];s&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",s.image),this.$set(this.attr.productSelect,"price",s.price),this.$set(this.attr.productSelect,"stock",s.stock),this.$set(this.attr.productSelect,"unique",s.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"attrValue",o.join(",")),this.$set(this.attr.productSelect,"vip_price",s.vip_price),this.$set(this,"attrTxt","已选择")):!s&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"vip_price",this.storeInfo.vip_price),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择")):s||t.length||(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",this.storeInfo.stock),this.$set(this.attr.productSelect,"unique",this.storeInfo.unique||""),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",this.storeInfo.vip_price),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},getCouponList:function(t){var e=this,o={page:1,limit:20,product_id:e.id};void 0===t&&null===t||(o.type=t),(0,s.getCoupons)(o).then((function(o){if(e.$set(e.coupon,"count",o.data.count),void 0===t||null===t){var i=f(e.coupon.count),n="",s=i.findIndex((function(t){return t})),r=e.coupon.count,a=[],c=0;r.forEach((function(t,e){0===t?c=e:a.push(t)})),n=3==a.length?2:2==a.length?2===c?1:2:r.findIndex((function(t){return t===i[s]})),e.$set(e.coupon,"type",n),e.getCouponList(n)}else e.$set(e.coupon,"list",o.data.list)}))},ChangCouponsUseState:function(t){var e=this;e.coupon.list[t].is_use=!0,e.$set(e.coupon,"list",e.coupon.list),e.$set(e.coupon,"coupon",!1)},setCollect:(0,h.Debounce)((function(){if(!1===this.isLogin)(0,a.toLogin)();else{var t=this;this.storeInfo.userCollect?(0,i.collectDel)(this.storeInfo.id).then((function(e){return t.$set(t.storeInfo,"userCollect",!t.storeInfo.userCollect),t.$util.Tips({title:e.msg})})):(0,i.collectAdd)(this.storeInfo.id).then((function(e){return t.$set(t.storeInfo,"userCollect",!t.storeInfo.userCollect),t.$util.Tips({title:e.msg})}))}})),selecAttr:(0,h.Debounce)((function(){this.currentPage=!1,this.$set(this.attr,"cartAttr",!0),this.$set(this,"isOpen",!0)})),couponTap:function(){var t=this;this.currentPage=!1,!1===t.isLogin?(0,a.toLogin)():(t.getCouponList(),t.$set(t.coupon,"coupon",!0))},onMyEvent:function(){this.$set(this.attr,"cartAttr",!1),this.$set(this,"isOpen",!1)},myEnsure:function(){this.$set(this.ensureInfo,"show",!1)},mySpecs:function(){this.$set(this.specsInfo,"show",!1)},myDiscount:function(){this.$set(this.discountInfo,"show",!1)},joinCart:function(t){this.currentPage=!1,!1===this.isLogin?(0,a.toLogin)():this.goCat()},goCat:function(e){var o=this,n=o.productValue[this.attrValue];if(o.attrValue?o.attr.cartAttr=!o.isOpen:o.isOpen?o.attr.cartAttr=!0:o.attr.cartAttr=!o.attr.cartAttr,!0===o.attr.cartAttr&&!1===o.isOpen)return o.isOpen=!0;if(o.attr.productAttr.length&&void 0===n&&!0===o.isOpen)return o.$util.Tips({title:"产品库存不足，请选择其它属性"});if(o.attr.productSelect.cart_num<=0)return o.attr.productSelect.cart_num=1,o.isOpen=!1,o.$util.Tips({title:"请先选择属性"});var s={productId:o.id,cartNum:o.attr.productSelect.cart_num,new:void 0===e?0:1,uniqueId:void 0!==o.attr.productSelect?o.attr.productSelect.unique:""};(0,i.postCartAdd)(s).then((function(i){o.isOpen=!1,o.attr.cartAttr=!1,e?t.navigateTo({url:"/pages/users/order_confirm/index?new=1&cartId="+i.data.cartId}):o.$util.Tips({title:"添加购物车成功",success:function(){o.getCartCount(!0)}})})).catch((function(t){return o.isOpen=!1,o.$util.Tips({title:t})}))},getCartCount:function(t){var e=this,o=this,i=o.isLogin;i&&(0,r.getCartCounts)().then((function(i){o.CartCount=i.data.count,e.$store.commit("indexData/setCartNum",o.CartCount>99?"...":o.CartCount+""),t&&(o.animated=!0,setTimeout((function(){o.animated=!1}),500))}))},goBuy:function(t){this.currentPage=!1,!1===this.isLogin?(0,a.toLogin)():this.goCat(!0)},authColse:function(t){this.isShowAuth=t},listenerActionSheet:function(){this.currentPage=!1,!1===this.isLogin?(0,a.toLogin)():(this.posters=!0,this.goPoster())},listenerActionClose:function(){this.posters=!1},posterImageClose:function(){this.posterImageStatus=!1,this.posters=!1},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilestoreImage:function(){var e=this;t.downloadFile({url:e.setDomain(e.storeInfo.image),success:function(t){e.storeImage=t.tempFilePath,e.base64Show=1},fail:function(){return e.$util.Tips({title:""})}})},downloadFilePromotionCode:function(e){var o=this;(0,i.getProductCode)(o.id).then((function(i){t.downloadFile({url:o.setDomain(i.data.code),success:function(t){o.$set(o,"isDown",!1),"function"==typeof e?e&&e(t.tempFilePath):o.$set(o,"PromotionCode",t.tempFilePath)},fail:function(){o.$set(o,"isDown",!1),o.$set(o,"PromotionCode","")}})})).catch((function(t){o.$set(o,"isDown",!1),o.$set(o,"PromotionCode","")}))},getImageBase64:function(t){var e=this;(0,u.imageBase64)(e.storeImage,e.followCode).then((function(o){e.storeImage=o.data.image,t&&(e.PromotionCode=o.data.code),e.base64Show=1})).catch((function(){}))},goPoster:function(){var e=this;e.$set(e,"canvasStatus",!0);var o=[e.posterbackgd,e.storeImage,e.PromotionCode];return""!=e.PromotionCode||e.isDown?e.isDown?e.$util.Tips({title:"正在下载海报,请稍后再试！"},(function(){e.posters=!1})):void t.getImageInfo({src:e.PromotionCode,fail:function(t){return e.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"})},success:function(){""==o[2]?e.downloadFilePromotionCode((function(t){if(o[2]=t,""==o[2])return e.$util.Tips({title:"海报二维码生成失败！"});e.$nextTick((function(){e.$util.PosterCanvas(e.fontColor,e.themeColor,e.siteName,o,e.storeInfo.store_name,e.storeInfo.price,e.storeInfo.ot_price,(function(t){e.$set(e,"posterImage",t),e.$set(e,"posterImageStatus",!0),e.$set(e,"canvasStatus",!1),e.$set(e,"actionSheetHidden",!e.actionSheetHidden)}))}))})):e.$nextTick((function(){e.$util.PosterCanvas(e.fontColor,e.themeColor,e.siteName,o,e.storeInfo.store_name,e.storeInfo.price,e.storeInfo.ot_price,(function(t){e.$set(e,"posterImage",t),e.$set(e,"posterImageStatus",!0),e.$set(e,"canvasStatus",!1),e.$set(e,"actionSheetHidden",!e.actionSheetHidden)}))}))}}):e.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"},(function(){e.posters=!1}))},copyCommand:function(){wx.navigateToMiniProgram&&wx.navigateToMiniProgram({appId:"wxb036cafe2994d7d0",path:"/publish/ugc-publish/ugc-publish",extraData:{productInfo:{title:this.storeInfo.store_name,path:"/pages/goods_details/index?id="+this.storeInfo.id,thumbUrl:this.storeInfo.image}}})},savePosterPath:function(){var e=this;t.getSetting({success:function(o){o.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})}})}})},tabCouponType:function(t){this.$set(this.coupon,"type",t),this.getCouponList(t)},goDiscounts:function(){t.navigateTo({url:"/pages/goods_details/discountsGoodsList?id="+this.id})}}};e.default=j}).call(this,o("543d")["default"])},b268:function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return i}));var i={jyfParser:function(){return Promise.all([o.e("common/vendor"),o.e("components/jyf-parser/jyf-parser")]).then(o.bind(null,"1732"))}},n=function(){var t=this,e=t.$createElement,o=(t._self._c,1==t.promotions_type?t.limitInfo.discount_price.toString().split("."):null),i=1==t.promotions_type?t.limitInfo.discount_price.toString().split("."):null,n=1==t.promotions_type&&i.length>1?t.limitInfo.discount_price.toString().split("."):null,s=t.storeInfo.brand_name&&t.storeInfo.brand_name.trim(),r=t.couponList.length?t.__map(t.couponList,(function(e,o){var i=t.__get_orig(e),n=o<2&&2==e.coupon_type?parseFloat(e.coupon_price):null;return{$orig:i,m0:n}})):null,a=t.attr.productAttr.length&&t.skuArr.length>1?t.skuArr.slice(0,4):null,c=t.isMention&&t.storeLen?parseInt(t.id):null,u=parseFloat(t.CartCount),l=parseInt(t.id);t._isMounted||(t.e0=function(e){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{g0:o,g1:i,g2:n,g3:s,l0:r,l1:a,m1:c,m2:u,m3:l}})},s=[]}},[["4ba4","common/runtime","common/vendor"]]]);