(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-199abc28"],{"082a":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form-submit"},[a("div",{staticClass:"i-layout-page-header"},[a("PageHeader",{staticClass:"product_tabs",attrs:{"hidden-breadcrumb":""}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("router-link",{attrs:{to:{path:"/admin/marketing/discount/full_discount"}}},[a("div",{staticClass:"font-sm after-line"},[a("span",{staticClass:"iconfont iconfanhui"}),a("span",{staticClass:"pl10"},[t._v("返回")])])]),a("span",{staticClass:"mr20 ml16",domProps:{textContent:t._s("0"!==t.$route.params.id?"编辑满减满折":"添加满减满折")}})],1)])],1),a("Card",{staticClass:"ivu-mt",staticStyle:{"margin-bottom":"79px"},attrs:{bordered:!1,"dis-hover":""}},[a("div",{staticClass:"new_tab"},[a("Tabs",{model:{value:t.currentTab,callback:function(e){t.currentTab=e},expression:"currentTab"}},t._l(t.headTab,(function(t,e){return a("TabPane",{key:e,attrs:{label:t.name,name:t.type}})})),1)],1),a("Form",{ref:"formValidate",staticClass:"formValidate mt20",attrs:{rules:t.ruleValidate,model:t.formValidate,"label-width":t.labelWidth,"label-position":t.labelPosition},nativeOn:{submit:function(t){t.preventDefault()}}},[a("Row",{directives:[{name:"show",rawName:"v-show",value:"1"===t.currentTab,expression:"currentTab === '1'"}],attrs:{gutter:24,type:"flex"}},[a("FormItem",{attrs:{label:"条件类型：",props:"coupon_type"}},t._l(t.discountType,(function(e,n){return a("div",{key:n,staticClass:"productType",class:t.formValidate.threshold_type==e.id?"on":"",on:{click:function(a){return t.discountTypeTap(e)}}},[a("div",{staticClass:"name",class:t.formValidate.threshold_type==e.id?"on":""},[t._v(t._s(e.name))]),a("div",{staticClass:"title"},[t._v("("+t._s(e.title)+")")]),t.formValidate.threshold_type==e.id?a("div",{staticClass:"jiao"}):t._e(),t.formValidate.threshold_type==e.id?a("div",{staticClass:"iconfont iconduihao"}):t._e()])})),0),a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"活动名称：",prop:"name"}},[a("Input",{directives:[{name:"width",rawName:"v-width",value:"50%",expression:"'50%'"}],attrs:{placeholder:"请输入活动名称"},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1)],1),a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"活动时间：",prop:"section_time"}},[a("div",{staticClass:"acea-row row-middle"},[a("DatePicker",{directives:[{name:"width",rawName:"v-width",value:"50%",expression:"'50%'"}],attrs:{editable:!1,type:"daterange",format:"yyyy-MM-dd",placeholder:"请选择活动时间",value:t.formValidate.section_time},on:{"on-change":t.onchangeTime},model:{value:t.formValidate.section_time,callback:function(e){t.$set(t.formValidate,"section_time",e)},expression:"formValidate.section_time"}})],1)])],1),a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"关联标签："}},[a("i-switch",{attrs:{"true-value":1,"false-value":0,size:"large"},model:{value:t.formValidate.is_label,callback:function(e){t.$set(t.formValidate,"is_label",e)},expression:"formValidate.is_label"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("开启")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("关闭")])]),t.formValidate.is_label?a("div",{staticClass:"acea-row row-middle mt10"},[a("div",{staticClass:"labelInput acea-row row-between-wrapper",on:{click:t.openLabel}},[a("div",{staticStyle:{width:"90%"}},[t.dataLabel.length?a("div",t._l(t.dataLabel,(function(e,n){return a("Tag",{attrs:{closable:""},on:{"on-close":function(a){return t.closeLabel(e)}}},[t._v(t._s(e.label_name))])})),1):a("span",{staticClass:"span"},[t._v("选择用户关联标签")])]),a("div",{staticClass:"iconfont iconxiayi"})]),a("span",{staticClass:"addClass",on:{click:t.addLabel}},[t._v("新增标签")])]):t._e()],1)],1),a("Col",{attrs:{span:"24"}},[a("FormItem",{staticStyle:{"margin-bottom":"0"},attrs:{label:"优惠内容：",prop:"promotions_cate"}},[a("RadioGroup",{attrs:{vertical:""},on:{"on-change":t.changeFull},model:{value:t.formValidate.promotions_cate,callback:function(e){t.$set(t.formValidate,"promotions_cate",e)},expression:"formValidate.promotions_cate"}},[a("Radio",{attrs:{label:"1"}},[a("Icon",{attrs:{type:"social-apple"}}),a("span",[t._v("阶梯满减满折")])],1),a("Radio",{attrs:{label:"2"}},[a("Icon",{attrs:{type:"social-android"}}),a("span",[t._v("循环满减满折")])],1)],1)],1),a("FormItem",{attrs:{label:""}},[a("div",{staticClass:"list"},t._l(t.promotionsData,(function(e,n){return a("div",{key:n,staticClass:"item"},[1==t.formValidate.promotions_cate?a("div",{staticClass:"title acea-row row-between-wrapper"},[a("span",[t._v(t._s(n+1)+"级优惠")]),n?a("span",{staticClass:"del",on:{click:function(e){return t.delGrade(n)}}},[t._v("删除")]):t._e()]):t._e(),a("FormItem",{attrs:{label:"优惠门槛：",prop:"threshold"}},[a("span",{staticClass:"mr10"},[2==t.formValidate.promotions_cate?a("span",[t._v("每")]):t._e(),t._v("满")]),1==t.formValidate.threshold_type?a("InputNumber",{staticStyle:{width:"230px"},attrs:{max:999999,min:0},model:{value:e.threshold,callback:function(a){t.$set(e,"threshold",a)},expression:"item.threshold"}}):a("InputNumber",{staticStyle:{width:"230px"},attrs:{max:999999,min:0,precision:0},model:{value:e.threshold,callback:function(a){t.$set(e,"threshold",a)},expression:"item.threshold"}}),a("span",{staticClass:"ml10"},[t._v(t._s(1==t.formValidate.threshold_type?"元":"件"))])],1),a("FormItem",{attrs:{label:"优惠内容：",prop:"discount"}},[a("RadioGroup",{attrs:{vertical:""},model:{value:e.discount_type,callback:function(a){t.$set(e,"discount_type",a)},expression:"item.discount_type"}},[a("Radio",{attrs:{label:1}},[a("span",{staticClass:"mr10"},[t._v("减")]),a("InputNumber",{staticStyle:{width:"230px"},attrs:{max:999999,min:0},model:{value:e.money,callback:function(a){t.$set(e,"money",a)},expression:"item.money"}}),a("span",{staticClass:"ml10"},[t._v("元")])],1),1==t.formValidate.promotions_cate?a("Radio",{attrs:{label:2}},[a("span",{staticClass:"mr10"},[t._v("打")]),a("InputNumber",{staticStyle:{width:"230px"},attrs:{max:100,min:1,precision:0},model:{value:e.discount,callback:function(a){t.$set(e,"discount",a)},expression:"item.discount"}}),a("span",{staticClass:"ml10"},[t._v("%")])],1):t._e()],1)],1)],1)})),0),1==t.formValidate.promotions_cate?a("Button",{attrs:{type:"primary"},on:{click:t.addLevel}},[t._v("添加优惠层级")]):t._e()],1)],1),a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"优惠叠加：",prop:"is_overlay"}},[a("RadioGroup",{attrs:{vertical:""},model:{value:t.formValidate.is_overlay,callback:function(e){t.$set(t.formValidate,"is_overlay",e)},expression:"formValidate.is_overlay"}},[a("Radio",{attrs:{label:"0"}},[a("Icon",{attrs:{type:"social-apple"}}),a("span",[t._v("不叠加其他营销活动")])],1),a("Radio",{attrs:{label:"1"}},[a("Icon",{attrs:{type:"social-android"}}),a("span",[t._v("叠加其他营销活动")])],1)],1),1==t.formValidate.is_overlay?a("CheckboxGroup",{staticClass:"checkAlls",attrs:{size:"small"},model:{value:t.formValidate.overlay,callback:function(e){t.$set(t.formValidate,"overlay",e)},expression:"formValidate.overlay"}},t._l(t.activityType,(function(e,n){return a("Checkbox",{attrs:{label:e.type}},[t._v(t._s(e.name))])})),1):t._e()],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"2"===t.currentTab,expression:"currentTab === '2'"}]},[a("Row",{attrs:{gutter:24,type:"flex"}},[a("Col",{attrs:{span:"24"}},[a("RadioGroup",{model:{value:t.formValidate.product_partake_type,callback:function(e){t.$set(t.formValidate,"product_partake_type",e)},expression:"formValidate.product_partake_type"}},[a("Radio",{attrs:{label:1}},[t._v("全部商品参与")]),a("Radio",{attrs:{label:2}},[t._v("指定商品参与")]),a("Radio",{attrs:{label:3}},[t._v("指定商品不参与")])],1)],1),1!=t.formValidate.product_partake_type?a("Col",{staticClass:"mt20",attrs:{span:"24"}},[a("Button",{attrs:{type:"primary"},on:{click:t.addGoods}},[t._v("添加商品")])],1):t._e()],1),1!=t.formValidate.product_partake_type?a("div",{staticClass:"vxeTable"},[a("vxe-table",{ref:"xTree",attrs:{border:"inner","column-config":{resizable:!0},"row-id":"id","tree-config":{children:"attrValue",reserve:!0},data:t.tableData}},[a("vxe-column",{attrs:{field:"info",title:"商品信息","tree-node":"","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("div",{staticClass:"imgPic acea-row row-middle"},[a("viewer",[a("div",{staticClass:"pictrue"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:n.image,expression:"row.image"}]})])]),a("div",{staticClass:"info"},[a("Tooltip",{attrs:{"max-width":"200",placement:"bottom",transfer:""}},[a("span",{staticClass:"line2"},[t._v(t._s(n.store_name)+t._s(n.suk))]),a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.store_name)+t._s(n.suk))])])],1)],1)]}}],null,!1,1988674042)}),a("vxe-column",{attrs:{field:"cate_name",title:"商品分类","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("Tooltip",{attrs:{"max-width":"200",placement:"bottom"}},[a("span",{staticClass:"line2"},[t._v(t._s(n.cate_name))]),a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.cate_name))])])]}}],null,!1,3349410013)}),a("vxe-column",{attrs:{field:"store_label",title:"商品标签","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("Tooltip",{attrs:{"max-width":"500",placement:"bottom"}},[a("span",{staticClass:"line2"},[t._v(t._s(n.store_label))]),a("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.store_label))])])]}}],null,!1,1664260762)}),a("vxe-column",{attrs:{field:"price",title:"售价","min-width":"80"}}),a("vxe-column",{attrs:{field:"cost",title:"成本价","min-width":"80"}}),a("vxe-column",{attrs:{field:"stock",title:"库存","min-width":"80"}}),a("vxe-column",{attrs:{field:"date",title:"操作","min-width":"150",fixed:"right",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("a",{on:{click:function(e){return t.del(n)}}},[t._v("删除")])]}}],null,!1,1383043590)})],1)],1):t._e()],1)],1)],1),a("Card",{staticClass:"fixed-card",style:{left:t.menuCollapse?t.isMobile?"0":"80px":"200px"},attrs:{bordered:!1,"dis-hover":""}},[a("Form",[a("FormItem",["1"!==t.currentTab?a("Button",{staticStyle:{"margin-right":"10px"},on:{click:t.upTab}},[t._v("上一步")]):t._e(),"2"!==t.currentTab?a("Button",{staticClass:"submission",attrs:{type:"primary"},on:{click:function(e){return t.downTab("formValidate")}}},[t._v("下一步")]):a("Button",{staticClass:"submission",attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("保存并发布")])],1)],1)],1),a("Modal",{attrs:{scrollable:"",title:"请选择用户标签",closable:!1,width:"320","footer-hide":!0,"mask-closable":!1},model:{value:t.labelShow,callback:function(e){t.labelShow=e},expression:"labelShow"}},[a("userLabel",{ref:"userLabel",on:{activeData:t.activeData,close:t.labelClose}})],1),a("Modal",{staticClass:"paymentFooter",attrs:{title:"商品列表",footerHide:"",scrollable:"",width:"900"},on:{"on-cancel":t.cancel},model:{value:t.modals,callback:function(e){t.modals=e},expression:"modals"}},[t.modals?a("goods-list",{ref:"goodslist",attrs:{ischeckbox:!0,isdiy:!0},on:{getProductId:t.getProductId}}):t._e()],1)],1)},r=[],i=a("2f62"),o=a("b7be"),s=a("c24f"),l=a("0f0e"),c=a("c4ad"),u=a("e449");function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(a,!0).forEach((function(e){f(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(a).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function f(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var p={name:"addPiecesDiscount",components:{userLabel:l["a"],goodsList:c["default"],couponList:u["a"]},data:function(){return{goodsType:0,grid:{xl:7,lg:7,md:12,sm:24,xs:24},modals:!1,tableData:[],headTab:[{name:"基础设置",type:"1"},{name:"添加商品",type:"2"}],discountType:[{name:"满N元",title:"例：满100元减10元",id:1},{name:"满N件",title:"例：满3件减10元",id:2}],activityType:[{name:"优惠券",type:"5"},{name:"第N件N折",type:"2"},{name:"限时折扣",type:"1"}],currentTab:"1",dataLabel:[],labelShow:!1,formValidate:{name:"",section_time:[],is_label:0,label_id:[],is_overlay:"0",overlay:[],product_partake_type:1,product_id:[],threshold_type:1,promotions_cate:"1",promotions:[]},promotionsData:[{threshold:0,discount_type:1,discount:1,money:0}],indexCoupon:0,indexGoods:0,ruleValidate:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],section_time:[{required:!0,type:"array",message:"请选择活动时间",trigger:"change"}],promotions_cate:[{required:!0,message:"请设置满送方式",trigger:"change"}],is_overlay:[{required:!0,message:"请设置优惠叠加",trigger:"change"}]}}},computed:m({},Object(i["e"])("admin/layout",["isMobile","menuCollapse"]),{labelWidth:function(){return this.isMobile?void 0:96},labelPosition:function(){return this.isMobile?"top":"right"},labelBottom:function(){return this.isMobile?void 0:15}}),created:function(){},mounted:function(){this.setCopyrightShow({value:!1}),0!=this.$route.params.id&&this.getDiscountInfo()},destroyed:function(){this.setCopyrightShow({value:!0})},methods:m({},Object(i["d"])("admin/layout",["setCopyrightShow"]),{changeFull:function(){this.promotionsData=[],this.addLevel()},addLevel:function(){var t={threshold:0,discount_type:1,discount:1,money:0};this.promotionsData.push(t)},discountTypeTap:function(t){this.formValidate.threshold_type=t.id,2==t.id&&this.promotionsData.forEach((function(t){t.threshold=0}))},getDiscountInfo:function(){var t=this;Object(o["t"])(this.$route.params.id).then((function(e){t.formValidate=e.data.info,t.formValidate.is_overlay=t.formValidate.is_overlay.toString(),t.formValidate.promotions_cate=t.formValidate.promotions_cate.toString(),t.tableData=e.data.info.products,t.dataLabel=e.data.info.label_id;var a=e.data.info.promotions;a.forEach((function(t){1==t.discount_type?(t.money=t.discount,t.discount=1):t.money=0})),t.promotionsData=a})).catch((function(e){t.$Message.error(e.msg)}))},del:function(t){var e=this;this.tableData.forEach((function(a,n){if(t.id==a.id)return e.tableData.splice(n,1);a.attrValue.forEach((function(r,i){if(t.id==r.id)return 1==a.attrValue.length?e.tableData.splice(n,1):a.attrValue.splice(i,1)}))}))},addLabel:function(){this.$modalForm(Object(s["N"])(0)).then((function(){}))},addGoods:function(){this.modals=!0},cancel:function(){this.modals=!1},unique:function(t){var e=new Map;return t.filter((function(t){return!e.has(t.id)&&e.set(t.id,1)}))},getProductId:function(t){this.modals=!1;var e=this.tableData.concat(t),a=this.unique(e);a.forEach((function(t){t.attrValue.forEach((function(e){e.cate_name=t.cate_name,e.store_label=t.store_label}))})),this.tableData=a},onchangeTime:function(t){this.formValidate.section_time=t},closeLabel:function(t){var e=this.dataLabel.indexOf(this.dataLabel.filter((function(e){return e.id==t.id}))[0]);this.dataLabel.splice(e,1)},activeData:function(t){this.labelShow=!1,this.dataLabel=t},openLabel:function(t){this.labelShow=!0,this.$refs.userLabel.userLabel(JSON.parse(JSON.stringify(this.dataLabel)))},labelClose:function(){this.labelShow=!1},delGrade:function(t){this.promotionsData.splice(t,1)},upTab:function(){1==this.currentTab&&0!=this.formValidate.product_type?this.currentTab=(Number(this.currentTab)-2).toString():this.currentTab=(Number(this.currentTab)-1).toString()},downTab:function(t){var e=this;this.$refs[t].validate((function(t){if(t){if(e.formValidate.is_label&&!e.dataLabel.length)return e.$Message.warning("请选择用户关联标签");if(parseInt(e.formValidate.is_overlay)&&!e.formValidate.overlay.length)return e.$Message.warning("请选择叠加的营销活动");if(""==e.formValidate.section_time[0])return e.$Message.warning("请选择活动时间");e.currentTab="2"}else e.$Message.warning("请完善数据")}))},handleSubmit:function(t){var e=this;this.$refs[t].validate((function(t){if(t){if(e.formValidate.is_label&&!e.dataLabel.length)return e.$Message.warning("请选择用户关联标签");if(parseInt(e.formValidate.is_overlay)&&!e.formValidate.overlay.length)return e.$Message.warning("请选择叠加的营销活动");if(""==e.formValidate.section_time[0])return e.$Message.warning("请选择活动时间");var a=[];if(e.promotionsData.forEach((function(t){if(null==t.threshold||0==t.threshold)return e.flag=!1,e.$Message.warning("请填写优惠门槛");if(2==t.discount_type&&(null==t.discount||0==t.discount))return e.flag=!1,e.$Message.warning("请填写优惠内容");if(1==t.discount_type&&(null==t.money||0==t.money))return e.flag=!1,e.$Message.warning("请填写优惠内容");e.flag=!0;var n={threshold:t.threshold,discount:1==t.discount_type?t.money:t.discount,discount_type:t.discount_type};a.push(n)})),!e.flag)return;var n=[];e.dataLabel.forEach((function(t){n.push(t.id)})),0==e.formValidate.is_label?e.formValidate.label_id=[]:e.formValidate.label_id=n;var r=[];if(e.tableData.forEach((function(t){var e={product_id:t.id,unique:[]};t.attrValue.length&&t.attrValue.forEach((function(t){e.unique.push(t.unique)})),r.push(e)})),1!=e.formValidate.product_partake_type&&!r.length)return e.$Message.error("请添加商品");e.formValidate.promotions=a,e.formValidate.product_id=r,Object(o["U"])(3,e.$route.params.id,e.formValidate).then((function(t){e.$router.push({path:"/admin/marketing/discount/full_discount"}),e.$Message.success(t.msg)})).catch((function(t){e.$Message.error(t.msg)}))}else e.$Message.warning("请完善数据")}))}})},h=p,b=(a("ef42"),a("2877")),_=Object(b["a"])(h,n,r,!1,null,"6ad237db",null);e["default"]=_.exports},"0f0e":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"label-wrapper"},[a("div",{staticClass:"list-box"},[t._l(t.labelList,(function(e,n){return t.isUser?a("div",{key:n,staticClass:"label-box"},[e.children&&e.children.length?a("div",{staticClass:"title"},[t._v("\n        "+t._s(e.label_name)+"\n      ")]):t._e(),e.children&&e.children.length?a("div",{staticClass:"list"},t._l(e.children,(function(e,n){return a("div",{key:n,staticClass:"label-item",class:{on:e.disabled},on:{click:function(a){return t.selectLabel(e)}}},[t._v("\n          "+t._s(e.label_name)+"\n        ")])})),0):t._e()]):t._e()})),t.isUser?t._e():a("div",[t._v("暂无标签")])],2),a("div",{staticClass:"footer"},[a("Button",{staticClass:"btns",attrs:{type:"primary"},on:{click:t.subBtn}},[t._v("确定")]),a("Button",{staticClass:"btns",attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("取消")])],1)])},r=[],i=a("c4c8"),o={name:"userLabel",props:{},data:function(){return{labelList:[],dataLabel:[],isUser:!1}},mounted:function(){},methods:{inArray:function(t,e){for(var a in e)if(e[a].id==t)return!0;return!1},userLabel:function(t){var e=this;this.dataLabel=t,Object(i["eb"])().then((function(t){t.data.map((function(t){t.children&&(e.isUser=!0,t.children.map((function(t){e.inArray(t.id,e.dataLabel)?t.disabled=!0:t.disabled=!1})))})),e.labelList=t.data,console.log(e.labelList)})).catch((function(t){e.$Message.error(t.msg)}))},selectLabel:function(t){if(t.disabled){var e=this.dataLabel.indexOf(this.dataLabel.filter((function(e){return e.id==t.id}))[0]);this.dataLabel.splice(e,1),t.disabled=!1}else this.dataLabel.push({label_name:t.label_name,id:t.id}),t.disabled=!0},subBtn:function(){this.$emit("activeData",JSON.parse(JSON.stringify(this.dataLabel)))},cancel:function(){this.$emit("close")}}},s=o,l=(a("21e3"),a("2877")),c=Object(l["a"])(s,n,r,!1,null,"9f6c2564",null);e["a"]=c.exports},"21e3":function(t,e,a){"use strict";var n=a("af17"),r=a.n(n);r.a},"3bc4":function(t,e,a){},"61f7":function(t,e,a){"use strict";function n(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(a,!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):n(a).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var n in a)if(new RegExp("(".concat(n,")")).test(e)){var r=a[n]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?r:s(r))}return e}function s(t){return("00"+t).substr(t.length)}a.d(e,"a",(function(){return o})),a.d(e,"c",(function(){return u})),a.d(e,"b",(function(){return d}));var l={min:"%s最小长度为:min",max:"%s最大长度为:max",length:"%s长度必须为:length",range:"%s长度为:range",pattern:"$s格式错误"};var c=function(t,e){t.message=function(t){return e.replace("%s",t||"")}};function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r({required:!0,message:t,type:"string"},e)}function d(t){return m.pattern(/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,t)}c(u,"请输入%s"),c(d,"%s格式不正确");var m=Object.keys(l).reduce((function(t,e){return t[e]=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o="range"===e?{min:t[0],max:t[1]}:i({},e,t);return r({message:a.replace(":".concat(e),"range"===e?"".concat(t[0],"-").concat(t[1]):t),type:"string"},o,{},n)},c(t[e],l[e]),t}),{})},af17:function(t,e,a){},c24f:function(t,e,a){"use strict";a.d(e,"S",(function(){return r})),a.d(e,"i",(function(){return i})),a.d(e,"p",(function(){return o})),a.d(e,"c",(function(){return s})),a.d(e,"g",(function(){return l})),a.d(e,"f",(function(){return c})),a.d(e,"o",(function(){return u})),a.d(e,"q",(function(){return d})),a.d(e,"G",(function(){return m})),a.d(e,"K",(function(){return f})),a.d(e,"I",(function(){return p})),a.d(e,"H",(function(){return h})),a.d(e,"e",(function(){return b})),a.d(e,"d",(function(){return _})),a.d(e,"l",(function(){return v})),a.d(e,"M",(function(){return g})),a.d(e,"n",(function(){return y})),a.d(e,"L",(function(){return w})),a.d(e,"X",(function(){return O})),a.d(e,"P",(function(){return k})),a.d(e,"N",(function(){return x})),a.d(e,"O",(function(){return C})),a.d(e,"R",(function(){return j})),a.d(e,"Q",(function(){return V})),a.d(e,"T",(function(){return T})),a.d(e,"t",(function(){return $})),a.d(e,"u",(function(){return S})),a.d(e,"U",(function(){return L})),a.d(e,"h",(function(){return D})),a.d(e,"W",(function(){return I})),a.d(e,"A",(function(){return N})),a.d(e,"Y",(function(){return P})),a.d(e,"k",(function(){return M})),a.d(e,"V",(function(){return R})),a.d(e,"D",(function(){return E})),a.d(e,"z",(function(){return F})),a.d(e,"y",(function(){return A})),a.d(e,"x",(function(){return q})),a.d(e,"B",(function(){return B})),a.d(e,"w",(function(){return G})),a.d(e,"v",(function(){return U})),a.d(e,"s",(function(){return W})),a.d(e,"r",(function(){return z})),a.d(e,"m",(function(){return J})),a.d(e,"j",(function(){return H})),a.d(e,"E",(function(){return Y})),a.d(e,"F",(function(){return K})),a.d(e,"Z",(function(){return Q})),a.d(e,"J",(function(){return X})),a.d(e,"C",(function(){return Z})),a.d(e,"b",(function(){return tt})),a.d(e,"a",(function(){return et})),a.d(e,"ab",(function(){return at}));var n=a("b6bd");function r(t){return Object(n["a"])({url:"user/user",method:"get",params:t})}function i(t){return Object(n["a"])({url:"user/user/".concat(t,"/edit"),method:"get"})}function o(t){return Object(n["a"])({url:"user/set_status/".concat(t.status,"/").concat(t.id),method:"put"})}function s(t){return Object(n["a"])({url:"marketing/coupon/grant",method:"get",params:t})}function l(t){return Object(n["a"])({url:"user/edit_other/".concat(t),method:"get"})}function c(t){return Object(n["a"])({url:"user/user/".concat(t),method:"get"})}function u(t){return Object(n["a"])({url:"user/one_info/".concat(t.id),method:"get",params:t.datas})}function d(t){return Object(n["a"])({url:"user/user_level/vip_list",method:"get",params:t})}function m(t){return Object(n["a"])({url:"user/user_level/set_show/".concat(t.id,"/").concat(t.is_show),method:"PUT"})}function f(t,e){return Object(n["a"])({url:"user/user_level/task/".concat(t),method:"get",params:e})}function p(t){return Object(n["a"])({url:"user/user_level/set_task_show/".concat(t.id,"/").concat(t.is_show),method:"PUT"})}function h(t){return Object(n["a"])({url:"user/user_level/set_task_must/".concat(t.id,"/").concat(t.is_must),method:"PUT"})}function b(t){return Object(n["a"])({url:"/user/user_level/create_task",method:"get",params:t})}function _(t){return Object(n["a"])({url:"user/user_level/create",method:"get",params:t})}function v(t){return Object(n["a"])({url:"user/give_level/".concat(t),method:"get"})}function g(t){return Object(n["a"])({url:"user/user_group/list",method:"get",params:t})}function y(t){return Object(n["a"])({url:"user/user_group/add/".concat(t),method:"get"})}function w(t){return Object(n["a"])({url:"setting/update_admin",method:"PUT",data:t})}function O(t){return Object(n["a"])({url:"user/set_group",method:"post",data:t})}function k(t){return Object(n["a"])({url:"user/user_label",method:"get",params:t})}function x(t,e){return Object(n["a"])({url:"user/user_label/add/".concat(t),method:"get",params:e})}function C(t){return Object(n["a"])({url:"user/user_label_cate/all",method:"get",params:t})}function j(t){return Object(n["a"])({url:"user/user_label_cate/".concat(t,"/edit"),method:"get"})}function V(t){return Object(n["a"])({url:"user/user_label_cate/create",method:"get"})}function T(t){return Object(n["a"])({url:"/user/member_batch/index",method:"get",params:t})}function $(t,e){return Object(n["a"])({url:"/user/member_batch/save/".concat(t),method:"post",data:e})}function S(t,e){return Object(n["a"])({url:"/user/member_batch/set_value/".concat(t),method:"get",params:e})}function L(t,e){return Object(n["a"])({url:"/user/member_card/index/".concat(t),method:"get",params:e})}function D(t,e){return Object(n["a"])({url:"/export/memberCard/".concat(t),method:"get",params:e})}function I(){return Object(n["a"])({url:"/user/member/ship",method:"get"})}function N(t,e){return Object(n["a"])({url:"/user/member_ship/save/".concat(t),method:"post",data:e})}function P(){return Object(n["a"])({url:"/user/user/syncUsers",method:"get"})}function M(){return Object(n["a"])({url:"/user/user/create",method:"get"})}function R(){return Object(n["a"])({url:"/user/member_scan",method:"get"})}function E(t,e){return Object(n["a"])({url:"user/label/".concat(t),method:"post",data:e})}function F(t){return Object(n["a"])({url:"user/member_right/save/".concat(t.id),method:"post",data:t})}function A(){return Object(n["a"])({url:"user/member/right",method:"get"})}function q(t){return Object(n["a"])({url:"/user/member/record",method:"get",params:t})}function B(){return Object(n["a"])({url:"user/member/ship_select",method:"get"})}function G(t){return Object(n["a"])({url:"user/member_card/set_status",method:"get",params:t})}function U(t){return Object(n["a"])({url:"user/member_ship/set_ship_status",method:"get",params:t})}function W(t,e){return Object(n["a"])({url:"user/member_agreement/save/".concat(t),method:"post",data:e})}function z(){return Object(n["a"])({url:"user/member/agreement",method:"get"})}function J(t){return Object(n["a"])({url:"user/give_level_time/".concat(t),method:"get"})}function H(t){return Object(n["a"])({url:"user/label/".concat(t),method:"get"})}function Y(t){return Object(n["a"])({url:"user/save_set_label",method:"put",data:t})}function K(t){return Object(n["a"])({url:"setting/info",method:"get"})}function Q(t){return Object(n["a"])({url:"user/visit_list/".concat(t.id),method:"get",params:t.datas})}function X(t){return Object(n["a"])({url:"user/spread_list/".concat(t.id),method:"get",params:t.datas})}function Z(t){return Object(n["a"])({url:"user/user/".concat(t.uid),method:"put",data:t})}function tt(t,e){return Object(n["a"])({url:"agent/set_agent_agreement/".concat(t),method:"post",data:e})}function et(){return Object(n["a"])({url:"agent/get_agent_agreement",method:"get"})}function at(){return Object(n["a"])({url:"user/synchro/work/label",method:"get"})}},e449:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{title:"优惠券列表",width:"60%"},on:{"on-ok":t.ok,"on-cancel":t.cancel},model:{value:t.isTemplate,callback:function(e){t.isTemplate=e},expression:"isTemplate"}},[a("Table",{ref:"table",staticClass:"mt25",attrs:{columns:t.columns,data:t.couponList,loading:t.loading,"highlight-row":"","no-userFrom-text":"暂无数据","no-filtered-userFrom-text":"暂无筛选结果"},on:{"on-select":t.handleSelectRow,"on-select-cancel":t.handleCancelRow,"on-select-all":t.handleSelectAll,"on-select-all-cancel":t.handleSelectAll,"on-selection-change":t.changeCheckbox},scopedSlots:t._u([{key:"coupon_price",fn:function(e){var n=e.row;return[1==n.coupon_type?a("span",[t._v(t._s(n.coupon_price)+"元")]):t._e(),2==n.coupon_type?a("span",[t._v(t._s(parseFloat(n.coupon_price)/10)+"折（"+t._s(n.coupon_price.toString().split(".")[0])+"%）")]):t._e()]}},{key:"count",fn:function(e){var n=e.row;e.index;return[n.is_permanent?a("span",[t._v("不限量")]):a("div",[a("span",{staticClass:"fa"},[t._v("发布："+t._s(n.total_count))]),a("span",{staticClass:"sheng"},[t._v("剩余："+t._s(n.remain_count))])])]}},{key:"start_time",fn:function(e){var n=e.row;e.index;return[n.start_time?a("div",[t._v("\n                        "+t._s(t._f("formatDate")(n.start_time))+" - "+t._s(t._f("formatDate")(n.end_time))+"\n                    ")]):a("span",[t._v("不限时")])]}},{key:"type",fn:function(e){var n=e.row;return[1===n.type?a("span",[t._v("品类券")]):2===n.type?a("span",[t._v("商品券")]):3===n.type?a("span",[t._v("会员券")]):a("span",[t._v("通用券")])]}},{key:"status",fn:function(e){var n=e.row;e.index;return[a("Tag",{directives:[{name:"show",rawName:"v-show",value:1===n.status,expression:"row.status===1"}],attrs:{color:"blue"}},[t._v("正常")]),a("Tag",{directives:[{name:"show",rawName:"v-show",value:0===n.status,expression:"row.status===0"}],attrs:{color:"gold"}},[t._v("未开启")]),a("Tag",{directives:[{name:"show",rawName:"v-show",value:-1===n.status,expression:"row.status=== -1"}],attrs:{color:"red"}},[t._v("已失效")])]}}])}),a("div",{staticClass:"acea-row row-right page"},[a("Page",{attrs:{total:t.total,"show-elevator":"","show-total":"","page-size":t.tableFrom.limit},on:{"on-change":t.receivePageChange}})],1)],1)],1)},r=[],i=a("b7be"),o=a("61f7");function s(t){return u(t)||c(t)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function u(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}var d={name:"index",filters:{formatDate:function(t){if(0!==t){var e=new Date(1e3*t);return Object(o["a"])(e,"yyyy-MM-dd hh:mm")}}},props:{couponids:{type:Array},updateIds:{type:Array},updateName:{type:Array},luckDraw:{type:Boolean,default:!1},discount:{type:Boolean,default:!1}},data:function(){return{currentid:0,productRow:{},isTemplate:!1,loading:!1,tableFrom:{receive_type:3,page:1,limit:10},total:0,ids:[],texts:[],columns:[{title:"ID",key:"id",width:60},{title:"优惠券名称",key:"title",minWidth:150},{title:"适用类型",slot:"type",minWidth:80},{title:"面值",slot:"coupon_price",minWidth:100},{title:"最低消费额",key:"use_min_price",minWidth:100},{title:"发布数量",slot:"count",minWidth:120},{title:"有效期限",slot:"start_time",minWidth:120},{title:"状态",slot:"status",minWidth:80}],couponList:[],selectedIds:new Set,selectedNames:new Set,couponVal:[]}},mounted:function(){},watch:{updateIds:function(t){this.selectedIds=new Set(t)},updateName:function(t){this.selectedNames=new Set(t)}},created:function(){var t=this,e={width:60,align:"center",render:function(e,a){var n=a.row.id,r=!1;r=t.currentid===n;var i=t;return e("div",[e("Radio",{props:{value:r},on:{"on-change":function(){i.currentid=n,t.productRow=a.row}}})])}},a={type:"selection",width:60,align:"center"};this.luckDraw?this.columns.unshift(e):this.columns.unshift(a)},methods:{unique:function(t){var e=new Map;return t.filter((function(t){return!e.has(t.id)&&e.set(t.id,1)}))},changeCheckbox:function(t){this.couponVal=t},handleSelectAll:function(t){var e=this;if(!this.discount){if(0===t.length){var a=this,n=a.$refs.table.data;n.forEach((function(t){if(a.selectedIds.has(t.id)){a.selectedIds.delete(t.id);var e=a.unique(Array.from(a.selectedNames));a.unique(Array.from(a.selectedNames)).forEach((function(a,n){a.id===t.id&&e.splice(n,1)})),a.selectedNames=new Set(e)}}))}else t.forEach((function(t){e.selectedIds.add(t.id),e.selectedNames.add({id:t.id,title:t.title})}));this.$nextTick((function(){e.setChecked()}))}},handleSelectRow:function(t,e){var a=this;this.discount||(this.selectedIds.add(e.id),this.selectedNames.add({id:e.id,title:e.title}),this.$nextTick((function(){a.setChecked()})))},handleCancelRow:function(t,e){var a=this;if(!this.discount){var n=this;n.selectedIds.delete(e.id);var r=Array.from(n.selectedNames);Array.from(n.selectedNames).forEach((function(t,a){t.id===e.id&&r.splice(a,1)})),n.selectedNames=new Set(r),this.$nextTick((function(){a.setChecked()}))}},setChecked:function(){this.ids=s(this.selectedIds),this.texts=s(this.selectedNames);var t=this.$refs.table.objData;for(var e in t)this.selectedIds.has(t[e].id)&&(t[e]._isChecked=!0)},cancel:function(){this.isTemplate=!1,this.luckDraw&&(this.currentid=0)},tableList:function(){var t=this;this.loading=!0,Object(i["R"])(this.tableFrom).then((function(e){var a=e.data;t.couponList=a.list,t.discount||t.$nextTick((function(){t.setChecked()})),t.total=a.count,t.loading=!1}))},ok:function(){this.luckDraw?(this.$emit("getCouponId",this.productRow),this.currentid=0):this.discount?this.$emit("getCouponList",this.couponVal):this.$emit("nameId",this.ids,this.texts)},receivePageChange:function(t){this.tableFrom.page=t,this.tableList()}}},m=d,f=a("2877"),p=Object(f["a"])(m,n,r,!1,null,"087440e6",null);e["a"]=p.exports},ef42:function(t,e,a){"use strict";var n=a("3bc4"),r=a.n(n);r.a}}]);